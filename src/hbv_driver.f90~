PROGRAM hbv
! Program that runs the HBV module with optimization option

!Written by: R.C. Nijzink june 2014
!References: 
!Adjustments: 


USE mo_hbvmodel
USE mo_readdata
USE mo_multi_obj
USE mo_objectives
USE mo_landscape_classes

IMPLICIT NONE


  
	integer                                 :: itsteps		         ! counter
	real*8, allocatable,dimension(:)	:: etp_data,prec_data, Qobs_data,q, temp_data
	real*8, allocatable, dimension(:,:)	:: output
	real*8,dimension(16)			:: param
	real*8,dimension(16)		        :: param_max
	real*8,dimension(16)			:: param_min
	real*8,dimension(4)			:: incon



print *, "Reading input data..."
call read_config()
call read_forcing(etp_data,prec_data, Qobs_data, temp_data)
call read_param(param, param_max, param_min, incon)

print *, "Starting landscape classification"

call landscape_classes(dem, facc, fdir, slope)





! --run the model without calibration--
if(Optim_flag .eqv. .FALSE.) then
print *, "Start HBV"

call hbvmodel(param,incon,prec_data,temp_data,etp_data,output)

print *, "HBV finished"


! --Start optimization--
else
print *, "Start optimizing"

call multi_obj(param_max,param_min,incon,prec_data,temp_data,etp_data,Qobs_data)


print *, "Finished"
end if






END PROGRAM
